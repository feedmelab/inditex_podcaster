{"ast":null,"code":"import _regeneratorRuntime from\"/Users/xavitorner/Downloads/inditex_podcaster/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/xavitorner/Downloads/inditex_podcaster/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createSlice}from\"@reduxjs/toolkit\";import axios from\"axios\";import{loadAxiosProgress}from\"axios-progress\";import{createAsyncThunk}from\"@reduxjs/toolkit\";import{applyFilter}from\"../../utils/utils\";loadAxiosProgress(axios);export var fetchPodcasts=createAsyncThunk(\"podcast/fetchPodcasts\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_,_ref){var rejectWithValue,dispatch,response,parsedData,podcasts;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:rejectWithValue=_ref.rejectWithValue,dispatch=_ref.dispatch;_context.prev=1;_context.next=4;return axios.get(\"https://api.allorigins.win/get?url=\".concat(encodeURIComponent(\"https://itunes.apple.com/us/rss/toppodcasts/limit=100/genre=1310/json\")));case 4:response=_context.sent;if(response.data){_context.next=7;break;}throw new Error(\"Server response was not as expected.\");case 7:parsedData=JSON.parse(response.data.contents);podcasts=parsedData.feed.entry.map(function(entry){var _entry$summary;return{id:entry.id.attributes[\"im:id\"],summary:((_entry$summary=entry.summary)===null||_entry$summary===void 0?void 0:_entry$summary.label)||\"\",\"im:name\":{label:entry[\"im:name\"].label},\"im:artist\":{label:entry[\"im:artist\"].label},\"im:image\":entry[\"im:image\"].map(function(image){return{label:image.label,attributes:{height:image.attributes.height}};})};});return _context.abrupt(\"return\",podcasts);case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);return _context.abrupt(\"return\",rejectWithValue(_context.t0.message));case 15:case\"end\":return _context.stop();}},_callee,null,[[1,12]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());export var fetchPodcastDetails=createAsyncThunk(\"podcast/fetchPodcastDetails\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(podcastId,_ref3){var rejectWithValue,dispatch,response,parsedData;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:rejectWithValue=_ref3.rejectWithValue,dispatch=_ref3.dispatch;_context2.prev=1;_context2.next=4;return axios.get(\"https://api.allorigins.win/get?url=\".concat(encodeURIComponent(\"https://itunes.apple.com/lookup?id=\".concat(podcastId,\"&media=podcast&entity=podcastEpisode&limit=20\"))));case 4:response=_context2.sent;if(!(!response.data||!response.data.contents)){_context2.next=7;break;}throw new Error(\"Server response was not as expected.\");case 7:_context2.next=9;return JSON.parse(response.data.contents);case 9:parsedData=_context2.sent;return _context2.abrupt(\"return\",parsedData.results);case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](1);return _context2.abrupt(\"return\",rejectWithValue(_context2.t0.message));case 16:case\"end\":return _context2.stop();}},_callee2,null,[[1,13]]);}));return function(_x3,_x4){return _ref4.apply(this,arguments);};}());var podcastSlice=createSlice({name:\"podcast\",initialState:{podcasts:[],status:\"idle\",error:null,lastFetch:null,filter:\"\",filteredPodcasts:[],isFetchingDetails:false,podcastDetails:null,podcastDetailsCache:{},summary:null,downloadProgress:0},reducers:{updateFilter:function updateFilter(state,action){state.filter=action.payload;state.filteredPodcasts=applyFilter(state.podcasts,state.filter);}},extraReducers:function extraReducers(builder){builder.addCase(fetchPodcasts.pending,function(state){state.status=\"loading\";}).addCase(fetchPodcasts.fulfilled,function(state,action){var oneHourAgo=Date.now()-60*60*1000;if(state.lastFetch>oneHourAgo){state.filteredPodcasts=applyFilter(state.podcasts,state.filter);}else{// Descargamos y almacenamos los nuevos podcasts en la caché\nstate.podcasts=action.payload;state.lastFetch=Date.now();state.filteredPodcasts=applyFilter(action.payload,state.filter);}state.status=\"succeeded\";}).addCase(fetchPodcasts.rejected,function(state,action){state.status=\"failed\";state.error=action.error.message;}).addCase(fetchPodcastDetails.pending,function(state){state.isFetchingDetails=true;}).addCase(fetchPodcastDetails.fulfilled,function(state,action){state.isFetchingDetails=false;state.podcastDetails=action.payload;var podcastId=action.meta.arg;// Comprobamos si los detalles del podcast están en la caché\nvar cachedDetails=state.podcastDetailsCache[podcastId];var currentDate=new Date().toDateString();if(cachedDetails&&cachedDetails.lastFetchDate===currentDate){// Utilizamos los detalles almacenados en la caché\nstate.podcastDetails=cachedDetails.details;}else{// Almacenamos los nuevos detalles en la caché\nstate.podcastDetailsCache[podcastId]={lastFetchDate:currentDate,details:action.payload,summary:action.payload.summary,podcastDetails:action.payload.podcastDetails};state.summary=action.payload.summary;// state.podcastDetails = action.payload.podcastDetails;\n}}).addCase(fetchPodcastDetails.rejected,function(state){state.isFetchingDetails=false;});}});var updateFilter=podcastSlice.actions.updateFilter;export{updateFilter};export default podcastSlice.reducer;","map":{"version":3,"names":["createSlice","axios","loadAxiosProgress","createAsyncThunk","applyFilter","fetchPodcasts","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_","_ref","rejectWithValue","dispatch","response","parsedData","podcasts","wrap","_callee$","_context","prev","next","get","concat","encodeURIComponent","sent","data","Error","JSON","parse","contents","feed","entry","map","_entry$summary","id","attributes","summary","label","image","height","abrupt","t0","message","stop","_x","_x2","apply","arguments","fetchPodcastDetails","_ref4","_callee2","podcastId","_ref3","_callee2$","_context2","results","_x3","_x4","podcastSlice","name","initialState","status","error","lastFetch","filter","filteredPodcasts","isFetchingDetails","podcastDetails","podcastDetailsCache","downloadProgress","reducers","updateFilter","state","action","payload","extraReducers","builder","addCase","pending","fulfilled","oneHourAgo","Date","now","rejected","meta","arg","cachedDetails","currentDate","toDateString","lastFetchDate","details","actions","reducer"],"sources":["/Users/xavitorner/Downloads/inditex_podcaster/src/features/podcast/podcastSlice.js"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { loadAxiosProgress } from \"axios-progress\";\n\nimport { createAsyncThunk } from \"@reduxjs/toolkit\";\n\nimport { applyFilter } from \"../../utils/utils\";\n\nloadAxiosProgress(axios);\n\nexport const fetchPodcasts = createAsyncThunk(\n  \"podcast/fetchPodcasts\",\n  async (_, { rejectWithValue, dispatch }) => {\n    try {\n      const response = await axios.get(\n        `https://api.allorigins.win/get?url=${encodeURIComponent(\n          \"https://itunes.apple.com/us/rss/toppodcasts/limit=100/genre=1310/json\"\n        )}`\n      );\n\n      if (!response.data) {\n        throw new Error(\"Server response was not as expected.\");\n      }\n\n      const parsedData = JSON.parse(response.data.contents);\n\n      const podcasts = parsedData.feed.entry.map((entry) => ({\n        id: entry.id.attributes[\"im:id\"],\n        summary: entry.summary?.label || \"\",\n        \"im:name\": { label: entry[\"im:name\"].label },\n        \"im:artist\": { label: entry[\"im:artist\"].label },\n        \"im:image\": entry[\"im:image\"].map((image) => ({\n          label: image.label,\n          attributes: { height: image.attributes.height },\n        })),\n      }));\n\n      return podcasts;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const fetchPodcastDetails = createAsyncThunk(\n  \"podcast/fetchPodcastDetails\",\n  async (podcastId, { rejectWithValue, dispatch }) => {\n    try {\n      const response = await axios.get(\n        `https://api.allorigins.win/get?url=${encodeURIComponent(\n          `https://itunes.apple.com/lookup?id=${podcastId}&media=podcast&entity=podcastEpisode&limit=20`\n        )}`\n      );\n\n      if (!response.data || !response.data.contents) {\n        throw new Error(\"Server response was not as expected.\");\n      }\n\n      const parsedData = await JSON.parse(response.data.contents);\n\n      return parsedData.results;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  }\n);\n\nconst podcastSlice = createSlice({\n  name: \"podcast\",\n  initialState: {\n    podcasts: [],\n    status: \"idle\",\n    error: null,\n    lastFetch: null,\n    filter: \"\",\n    filteredPodcasts: [],\n    isFetchingDetails: false,\n    podcastDetails: null,\n    podcastDetailsCache: {},\n    summary: null,\n    downloadProgress: 0,\n  },\n  reducers: {\n    updateFilter: (state, action) => {\n      state.filter = action.payload;\n      state.filteredPodcasts = applyFilter(state.podcasts, state.filter);\n    },\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(fetchPodcasts.pending, (state) => {\n        state.status = \"loading\";\n      })\n      .addCase(fetchPodcasts.fulfilled, (state, action) => {\n        let oneHourAgo = Date.now() - 60 * 60 * 1000;\n\n        if (state.lastFetch > oneHourAgo) {\n          state.filteredPodcasts = applyFilter(state.podcasts, state.filter);\n        } else {\n          // Descargamos y almacenamos los nuevos podcasts en la caché\n          state.podcasts = action.payload;\n          state.lastFetch = Date.now();\n          state.filteredPodcasts = applyFilter(action.payload, state.filter);\n        }\n        state.status = \"succeeded\";\n      })\n      .addCase(fetchPodcasts.rejected, (state, action) => {\n        state.status = \"failed\";\n        state.error = action.error.message;\n      })\n      .addCase(fetchPodcastDetails.pending, (state) => {\n        state.isFetchingDetails = true;\n      })\n      .addCase(fetchPodcastDetails.fulfilled, (state, action) => {\n        state.isFetchingDetails = false;\n        state.podcastDetails = action.payload;\n\n        const podcastId = action.meta.arg;\n        // Comprobamos si los detalles del podcast están en la caché\n        const cachedDetails = state.podcastDetailsCache[podcastId];\n        const currentDate = new Date().toDateString();\n\n        if (cachedDetails && cachedDetails.lastFetchDate === currentDate) {\n          // Utilizamos los detalles almacenados en la caché\n          state.podcastDetails = cachedDetails.details;\n        } else {\n          // Almacenamos los nuevos detalles en la caché\n          state.podcastDetailsCache[podcastId] = {\n            lastFetchDate: currentDate,\n            details: action.payload,\n            summary: action.payload.summary,\n            podcastDetails: action.payload.podcastDetails,\n          };\n          state.summary = action.payload.summary;\n          // state.podcastDetails = action.payload.podcastDetails;\n        }\n      })\n      .addCase(fetchPodcastDetails.rejected, (state) => {\n        state.isFetchingDetails = false;\n      });\n  },\n});\n\nexport const { updateFilter } = podcastSlice.actions;\n\nexport default podcastSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}